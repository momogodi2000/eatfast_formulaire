<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription Newsletter Eat Fast üá®üá≤</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Eat Fast">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Eat Fast">
    <meta name="description" content="Inscription √† la newsletter Eat Fast - Application de livraison 100% camerounaise">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#228B22">
    
    <!-- Manifest -->
    <link rel="manifest" href="../pwa/manifest.json">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" href="../assets/image/eat_fast.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../assets/image/eat_fast.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../assets/image/eat_fast.png">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" as="style">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#228B22',
                        secondary: '#FFD700',
                        accent: '#DC143C',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'float-fast': 'float 4s ease-in-out infinite',
                        'pulse-slow': 'pulse 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            }
            .transform-3d {
                transform-style: preserve-3d;
            }
            .rotate-y-15 {
                transform: rotateY(15deg);
            }
            .rotate-y-0 {
                transform: rotateY(0deg);
            }
            .transition-3d {
                transition: transform 0.5s ease, box-shadow 0.5s ease;
            }
            .perspective {
                perspective: 1000px;
            }
        }
        
        /* Responsive media queries for better mobile optimization */
        @media (max-width: 640px) {
            .transform-3d {
                transform: none !important;
            }
            .hover\:rotate-y-15:hover {
                transform: none !important;
            }
            .text-shadow {
                text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            }
        }
        
        @media (max-width: 480px) {
            .perspective {
                perspective: none;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-primary via-secondary to-accent min-h-screen p-2 sm:p-3 md:p-5 font-sans">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-md mb-4">
        <div class="max-w-4xl mx-auto px-5 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <img src="../assets/image/eat_fast.png" alt="Eat Fast Logo" class="w-8 h-8 rounded-full">
                    <span class="font-bold text-xl text-gray-800">Eat Fast</span>
                </div>
                <a href="./about_us.html" 
                   class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 flex items-center">
                    <span class="mr-2">‚Üê</span>
                    Retour √† la page d'accueil
                </a>
            </div>
        </div>
    </nav>

    <div class="max-w-xs sm:max-w-sm md:max-w-lg lg:max-w-2xl mx-auto bg-white rounded-xl sm:rounded-2xl shadow-lg sm:shadow-xl overflow-hidden transform-3d transition-3d md:hover:rotate-y-15 perspective">
        <!-- Header with 3D effect -->
        <div class="bg-gradient-to-r from-primary to-secondary p-4 sm:p-6 md:p-8 text-center text-white">
            <div class="animate-float mx-auto mb-4 sm:mb-6 w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-full flex items-center justify-center shadow-lg">
                <img src="../assets/image/eat_fast.png" alt="Eat Fast Logo" class="w-12 h-12 sm:w-16 sm:h-16 rounded-full object-contain" id="logo">
            </div>
            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-shadow mb-2 leading-tight">
                Inscription √† la newsletter Eat Fast 
                <span class="inline-block animate-pulse">üá®üá≤</span>
            </h1>
            <p class="opacity-90 text-sm sm:text-base px-2">Rejoignez la r√©volution de la livraison au Cameroun</p>
        </div>
        
        <div class="p-4 sm:p-6 md:p-8 lg:p-10">
            <div class="bg-gray-50 p-4 sm:p-6 rounded-lg sm:rounded-xl mb-6 sm:mb-8 border-l-4 border-primary">
                <p class="text-sm sm:text-base leading-relaxed">
                    <strong class="text-primary">Eat-Fast</strong> est une application 100 % camerounaise de livraison de nourriture. Elle vise √† connecter les consommateurs aux meilleurs restaurants locaux, avec un service rapide et fiable. Le lancement est pr√©vu √† Yaound√©, avec une expansion progressive √† l'√©chelle nationale. Inscrivez-vous pour recevoir les derni√®res actualit√©s, offres sp√©ciales et opportunit√©s !
                </p>
            </div>
            
            <div id="successMessage" class="bg-green-100 text-green-800 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6 border border-green-200 hidden animate_animated animate_fadeIn text-sm sm:text-base">
                ‚úÖ Inscription r√©ussie ! Merci de votre int√©r√™t pour Eat Fast. Vous recevrez bient√¥t nos actualit√©s !
            </div>
            
            <div id="errorMessage" class="bg-red-100 text-red-800 p-3 sm:p-4 rounded-lg mb-4 sm:mb-6 border border-red-200 hidden animate_animated animate_fadeIn text-sm sm:text-base">
                ‚ùå Une erreur s'est produite. Veuillez r√©essayer ou nous contacter directement.
            </div>
            
            <form id="eatFastForm" class="space-y-4 sm:space-y-6">
                <div>
                    <label for="email" class="block font-semibold text-gray-700 mb-2 text-sm sm:text-base">
                        Adresse e-mail <span class="text-accent">*</span>
                    </label>
                    <input type="email" id="email" name="email" required placeholder="votre.email@exemple.com" 
                           class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 text-sm sm:text-base">
                </div>
                
                <div>
                    <label for="role" class="block font-semibold text-gray-700 mb-2 text-sm sm:text-base">
                        Je m'inscris en tant que <span class="text-accent">*</span>
                    </label>
                    <select id="role" name="role" required 
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 appearance-none bg-white text-sm sm:text-base">
                        <option value="">Choisissez votre profil</option>
                        <option value="customer">Client - Je veux commander des repas</option>
                        <option value="restaurant">Restaurateur - Je veux vendre sur EatFast</option>
                        <option value="delivery">Livreur - Je veux devenir partenaire de livraison</option>
                    </select>
                    <p class="mt-2 text-sm text-gray-500">
                        üöÄ Lancement : Web (12 Novembre 2024) | Mobile (10 D√©cembre 2024)
                    </p>
                </div>
                
                <div>
                    <label for="nom" class="block font-semibold text-gray-700 mb-2 text-sm sm:text-base">
                        Nom complet (optionnel)
                    </label>
                    <input type="text" id="nom" name="nom" placeholder="Votre nom complet" 
                           class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 text-sm sm:text-base">
                    <small class="text-gray-500 text-xs sm:text-sm">Cela nous permet de mieux personnaliser nos messages.</small>
                </div>
                
                <div>
                    <label class="block font-semibold text-gray-700 mb-2 text-sm sm:text-base">
                        Souhaitez-vous recevoir nos newsletters ?
                    </label>
                    <div class="space-y-2 sm:space-y-3 mt-3">
                        <div class="flex items-start sm:items-center p-2 sm:p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-200">
                            <input type="checkbox" id="updates" name="preferences" value="updates" 
                                   class="w-4 h-4 sm:w-5 sm:h-5 text-primary rounded focus:ring-primary border-gray-300 mt-0.5 sm:mt-0 flex-shrink-0">
                            <label for="updates" class="ml-2 sm:ml-3 text-xs sm:text-sm leading-relaxed">
                                Oui, je veux recevoir les mises √† jour sur l'application
                            </label>
                        </div>
                        <div class="flex items-start sm:items-center p-2 sm:p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-200">
                            <input type="checkbox" id="offers" name="preferences" value="offers" 
                                   class="w-4 h-4 sm:w-5 sm:h-5 text-primary rounded focus:ring-primary border-gray-300 mt-0.5 sm:mt-0 flex-shrink-0">
                            <label for="offers" class="ml-2 sm:ml-3 text-xs sm:text-sm leading-relaxed">
                                Oui, je suis int√©ress√©(e) par les offres et promotions
                            </label>
                        </div>
                        <div class="flex items-start sm:items-center p-2 sm:p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-200">
                            <input type="checkbox" id="beta" name="preferences" value="beta" 
                                   class="w-4 h-4 sm:w-5 sm:h-5 text-primary rounded focus:ring-primary border-gray-300 mt-0.5 sm:mt-0 flex-shrink-0">
                            <label for="beta" class="ml-2 sm:ml-3 text-xs sm:text-sm leading-relaxed">
                                Oui, je veux participer √† la phase de test (beta)
                            </label>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label for="ville" class="block font-semibold text-gray-700 mb-2 text-sm sm:text-base">
                        Dans quelle ville √™tes-vous bas√©(e) ? <span class="text-accent">*</span>
                    </label>
                    <input type="text" id="ville" name="ville" required placeholder="Ex: Yaound√©, Douala, Bafoussam..." 
                           class="w-full px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-300 text-sm sm:text-base">
                    <small class="text-gray-500 text-xs sm:text-sm">Pour vous informer du lancement dans votre r√©gion.</small>
                </div>
                
                <button type="submit" id="submitBtn" 
                        class="w-full bg-gradient-to-r from-primary to-green-600 text-white py-3 sm:py-4 px-4 sm:px-6 rounded-full font-bold text-sm sm:text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition duration-300 flex items-center justify-center">
                    <span class="text-center">üöÄ Rejoindre la communaut√© Eat Fast</span>
                    <span id="loading" class="ml-2 hidden animate-spin">‚è≥</span>
                </button>
            </form>
        </div>
        
        <div class="bg-gray-50 p-4 sm:p-6 text-center text-gray-600 text-xs sm:text-sm">
            <p class="leading-relaxed">
                ¬© 2025 Eat Fast - Application 100% camerounaise 
                <span class="inline-block animate-pulse-slow">üá®üá≤</span>
            </p>
            <p class="mt-1 leading-relaxed">Votre adresse email ne sera pas partag√©e avec des tiers.</p>
        </div>
    </div>

    <script>
        // Replace this URL with your Google Apps Script web app URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwsKDsaCI4OuGzsqjcWp7yZGbL6ijSBrUTUvC5dHkPEBqaXoBPWX40PIQpmpAJ2nzCR7A/exec';
        
        // Email configuration
        const EMAIL_CONFIG = {
            host: 'smtp.gmail.com',
            port: 587,
            useTLS: true,
            useSSL: false,
            user: 'yvangodimomo@gmail.com',
            password: 'pzls apph esje cgdl'
        };
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('../pwa/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Load logo dynamically and optimize image loading
        document.addEventListener('DOMContentLoaded', function() {
            const logo = document.getElementById('logo');
            // Replace with your actual logo URL
            logo.src = '../assets/image/eat_fast.png';
            
            // Add loading optimization
            logo.addEventListener('load', () => {
                logo.classList.add('loaded');
            });
            
            // Add 3D hover effect to container
            const container = document.querySelector('.container');
            
            // Install PWA prompt
            let deferredPrompt;
            const installButton = document.getElementById('install-button');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                if (installButton) {
                    installButton.style.display = 'block';
                }
            });
        });
        
        // Email sending function (using Google Apps Script or backend)
        async function sendConfirmationEmail(email, nom, role) {
            try {
                const emailData = {
                    to: email,
                    subject: 'Bienvenue dans la communaut√© Eat Fast ! üöÄ',
                    body: `
                        <h2>Bienvenue chez Eat Fast !</h2>
                        <p>Bonjour ${nom || 'Cher(e) futur(e) client(e)'},</p>
                        <p>Merci de votre inscription √† notre newsletter. Vous √™tes maintenant membre de la communaut√© Eat Fast !</p>
                        <p><strong>Votre profil :</strong> ${role}</p>
                        <p>Nous vous tiendrons inform√©(e) de nos actualit√©s et du lancement officiel :</p>
                        <ul>
                            <li>üåü Version Web : 12 Novembre 2024</li>
                            <li>üì± Version Mobile : 10 D√©cembre 2024</li>
                        </ul>
                        <p>Restez connect√©(e) pour √™tre parmi les premiers √† d√©couvrir notre plateforme !</p>
                        <p>L'√©quipe Eat Fast üá®üá≤</p>
                    `
                };
                
                // This would be handled by Google Apps Script or your backend
                return await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'sendEmail',
                        data: emailData
                    })
                });
            } catch (error) {
                console.error('Email sending error:', error);
                throw error;
            }
        }
        
        // Handle offline form submissions
        function syncOfflineSubmissions() {
            const submissions = JSON.parse(localStorage.getItem('eatfast_submissions') || '[]');
            
            if (submissions.length > 0 && navigator.onLine) {
                submissions.forEach(async (submission, index) => {
                    try {
                        await fetch(SCRIPT_URL, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(submission)
                        });
                        
                        // Remove sent submission
                        submissions.splice(index, 1);
                        localStorage.setItem('eatfast_submissions', JSON.stringify(submissions));
                        
                    } catch (error) {
                        console.error('Failed to sync submission:', error);
                    }
                });
            }
        }
        
        // Check for online status and sync
        window.addEventListener('online', syncOfflineSubmissions);
        
        // Initial sync check
        document.addEventListener('DOMContentLoaded', syncOfflineSubmissions);
        
        document.getElementById('eatFastForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            // Hide messages
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');
            
            // Show loading state
            submitBtn.disabled = true;
            loading.classList.remove('hidden');
            submitBtn.classList.remove('hover:-translate-y-1');
            
            try {
                // Collect form data
                const formData = new FormData(this);
                const data = {};
                
                data.email = formData.get('email');
                data.role = formData.get('role');
                data.nom = formData.get('nom');
                data.ville = formData.get('ville');
                data.preferences = formData.getAll('preferences');
                data.timestamp = new Date().toISOString();
                
                // Validate required fields
                if (!data.email || !data.role || !data.ville) {
                    throw new Error('Veuillez remplir tous les champs obligatoires');
                }
                
                // Store in localStorage first (for offline capabilities)
                const submissions = JSON.parse(localStorage.getItem('eatfast_submissions') || '[]');
                submissions.push(data);
                localStorage.setItem('eatfast_submissions', JSON.stringify(submissions));
                
                // Try to send to Google Sheets
                if (navigator.onLine) {
                    try {
                        const response = await fetch(SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        });
                        
                        // Remove from localStorage since it was sent successfully
                        const updatedSubmissions = JSON.parse(localStorage.getItem('eatfast_submissions') || '[]');
                        const index = updatedSubmissions.findIndex(sub => sub.email === data.email && sub.timestamp === data.timestamp);
                        if (index > -1) {
                            updatedSubmissions.splice(index, 1);
                            localStorage.setItem('eatfast_submissions', JSON.stringify(updatedSubmissions));
                        }
                        
                        // Show success message with animation
                        successMessage.innerHTML = `‚úÖ Inscription r√©ussie ! Merci de votre int√©r√™t pour Eat Fast. <br>Un email de confirmation a √©t√© envoy√© √† <strong>${data.email}</strong> !`;
                        
                    } catch (fetchError) {
                        console.warn('Failed to send online, stored locally:', fetchError);
                        successMessage.innerHTML = `‚úÖ Inscription sauvegard√©e ! Vos donn√©es seront envoy√©es d√®s que la connexion sera r√©tablie. <br>Email: <strong>${data.email}</strong>`;
                    }
                } else {
                    // Offline mode
                    successMessage.innerHTML = `‚úÖ Inscription sauvegard√©e ! Vos donn√©es seront envoy√©es d√®s que la connexion sera r√©tablie. <br>Email: <strong>${data.email}</strong>`;
                }
                
                successMessage.classList.remove('hidden');
                successMessage.classList.add('animate__fadeIn');
                this.reset();
                
                // Scroll to success message
                successMessage.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error:', error);
                errorMessage.innerHTML = `‚ùå ${error.message || 'Une erreur s\'est produite. Veuillez r√©essayer ou nous contacter directement.'}`;
                errorMessage.classList.remove('hidden');
                errorMessage.classList.add('animate__fadeIn');
                errorMessage.scrollIntoView({ behavior: 'smooth' });
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                loading.classList.add('hidden');
                submitBtn.classList.add('hover:-translate-y-1');
            }
        });
    </script>
</body>
</html>
